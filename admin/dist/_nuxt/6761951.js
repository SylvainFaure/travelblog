(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{340:function(e,t,r){"use strict";r.r(t);r(17),r(30),r(18),r(53),r(46),r(47),r(31),r(38),r(61),r(19),r(25);var l=r(4),o=r(13),n=r(276),c=r(26),d=r(299);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={props:{assets:n.a.array.def([]),travels:n.a.array.def([]),article:n.a.array.def(null)},data:function(){return{isNew:!0,mounted:!1,countries:[],model:{id:"",published:!1,published_date:"",title:"",cover:null,travel:null,country:{},place:"",dates:null,slug:"",gallery:[],short_desc:"",long_desc:null}}},computed:f(f({},Object(c.c)("modal",["visible","modalId"])),{},{locale:function(){return this.$i18n.locale}}),mounted:function(){var e=this;if(this.isNew=!this.article||!this.article[0]||!this.article[0].article_id,this.isNew)this.mounted=!0;else try{var t=Object(d.a)("article",{data:this.article[0],locale:this.locale,otherData:{travels:this.travels,assets:this.assets}});Object.keys(t).forEach((function(r){e.model[r]=t[r],"country"===r&&console.log(e.model[r])})),this.getCountries(t.travel,!1),this.mounted=!0}catch(e){console.warn(e),this.$router.push("/articles")}},methods:f(f({},Object(c.b)("modal",["setVisible","setModalId"])),{},{getCountries:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.model.country&&(this.model.country=null);var r=e["travel_countries_".concat(this.locale)]?JSON.parse(e["travel_countries_".concat(this.locale)]):null;this.countries=r&&r.length?r.map((function(e){return{key:e.toLowerCase().replace(" ","_"),label:e}})):[]},handleGalleryChange:function(e){this.model.gallery=e},saveArticle:function(){this.model.long_desc=this.$refs.longDescription.getBlocks(),this.model.gallery=this.$refs.gallery.getContent();var e=Object(d.b)("article",{data:this.model,store:this.$store.state,locale:this.locale});e.article_id?this.updateArticle(e):this.createArticle(e)},createArticle:function(article){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var r,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.post("/api/articles",article);case 3:r=t.sent,l=r.data,e.$toast.success(e.$t("article.save.success")),e.$router.push("/articles/".concat(l[0].article_id)),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),console.warn(t.t0),e.$toast.error(e.$t("article.save.error"));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},updateArticle:function(article){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.put("/api/articles/".concat(article.article_id),article);case 3:e.$toast.success(e.$t("article.update.success")),t.next=10;break;case 6:t.prev=6,t.t0=t.catch(0),console.warn(t.t0),e.$toast.error(e.$t("article.update.error"));case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))()},publishArticle:function(){},removeArticle:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.delete("/api/articles/".concat(e.model.id));case 3:e.$toast.success(e.$t("article.remove.success")),e.closeRemoveModal(),e.$router.push("/articles"),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.warn(t.t0),e.$toast.error(e.$t("article.remove.error"));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},openRemoveModal:function(){this.setVisible(!0),this.setModalId("remove-article")},closeRemoveModal:function(){this.setVisible(!1),this.setModalId(null)}})},v=r(22),component=Object(v.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("EntityActions",{attrs:{"is-new":e.isNew},on:{save:e.saveArticle,publish:e.publishArticle,remove:e.openRemoveModal}},[e.mounted?r("form",[r("InputText",{attrs:{label:e.$t("article.title")},model:{value:e.model.title,callback:function(t){e.$set(e.model,"title",t)},expression:"model.title"}}),e._v(" "),r("ChooseImage",{attrs:{image:e.model.cover,assets:e.assets,label:e.$t("article.cover")},on:{change:function(t){e.model.cover=t}}}),e._v(" "),r("Select",{attrs:{label:e.$t("article.travel"),options:e.travels,"option-label":"travel_title_"+e.locale},on:{input:e.getCountries},model:{value:e.model.travel,callback:function(t){e.$set(e.model,"travel",t)},expression:"model.travel"}}),e._v(" "),r("Select",{attrs:{label:e.$t("article.country"),options:e.countries},model:{value:e.model.country,callback:function(t){e.$set(e.model,"country",t)},expression:"model.country"}}),e._v(" "),r("InputText",{attrs:{label:e.$t("article.place")},model:{value:e.model.place,callback:function(t){e.$set(e.model,"place",t)},expression:"model.place"}}),e._v(" "),r("Datepicker",{attrs:{label:e.$t("article.dates"),model:e.model.dates},on:{change:function(t){e.model.dates=t}}}),e._v(" "),r("InputText",{attrs:{label:e.$t("article.slug")},model:{value:e.model.slug,callback:function(t){e.$set(e.model,"slug",t)},expression:"model.slug"}}),e._v(" "),r("Textarea",{attrs:{label:e.$t("article.short_desc")},model:{value:e.model.short_desc,callback:function(t){e.$set(e.model,"short_desc",t)},expression:"model.short_desc"}}),e._v(" "),r("GalleryEditor",{ref:"gallery",attrs:{label:e.$t("article.gallery"),assets:e.assets,gallery:e.model.gallery,picked:e.model.gallery},on:{"gallery-change":e.handleGalleryChange}}),e._v(" "),r("BlockEditor",{ref:"longDescription",attrs:{label:e.$t("travel.long_desc"),addons:["map-description"],blocks:e.model.long_desc,assets:e.assets}})],1):e._e()]),e._v(" "),"remove-article"===e.modalId?r("RemoveModal",{on:{confirm:e.removeArticle,cancel:e.closeRemoveModal}}):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{InputText:r(282).default,ChooseImage:r(304).default,Select:r(285).default,Datepicker:r(305).default,Textarea:r(286).default,GalleryEditor:r(343).default,BlockEditor:r(306).default,EntityActions:r(307).default,RemoveModal:r(284).default})},343:function(e,t,r){"use strict";r.r(t);r(17),r(30),r(18),r(46),r(47),r(31),r(19);var l=r(13),o=r(276),n=r(26);function c(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var m={props:{id:o.a.string.def(null),label:o.a.string.def("Choose an image"),gallery:o.a.array.def([]),assets:o.a.array.def([])},data:function(){return{galleryModel:[],realId:Math.floor(1e4*Math.random())}},computed:d(d({},Object(n.c)("modal",["visible","modalId"])),{},{isEditable:function(){return this.galleryModel&&this.galleryModel.length<4}}),mounted:function(){this.gallery&&this.gallery.length&&(this.galleryModel=this.gallery),this.id&&(this.realId=this.id)},methods:d(d({},Object(n.b)("modal",["setVisible","setModalId"])),{},{openModal:function(){this.setVisible(!0),this.setModalId("pick-gallery-".concat(this.realId))},confirmGallery:function(e){this.galleryModel=e},removeAsset:function(e){this.galleryModel=this.galleryModel.filter((function(a){return a.asset_id!==e.asset_id}))},getContent:function(){return this.galleryModel}})},f=r(22),component=Object(f.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.label?r("h4",{staticClass:"label font-bold my-4"},[r("span",{staticClass:"bg-white z-10 pr-6"},[e._v(e._s(e.label))])]):e._e(),e._v(" "),r("div",[e.galleryModel&&e.galleryModel.length?r("div",{staticClass:"flex"},e._l(e.galleryModel,(function(img){return r("div",{key:img.asset_id,staticClass:"mr-4 relative w-1/4"},[r("span",{staticClass:"absolute top-0 right-0 m-2 text-white",on:{click:function(t){return e.removeAsset(img)}}},[r("Icon",{attrs:{name:"cross"}})],1),e._v(" "),r("img",{staticClass:"mx-2",attrs:{src:img.asset_src}})])})),0):e._e(),e._v(" "),e.isEditable?r("div",{staticClass:"flex justify-end w-full"},[r("Btn",{attrs:{"icon-btn":"",icon:e.galleryModel&&e.galleryModel.length?"pencil":"plus"},on:{click:e.openModal}})],1):e._e(),e._v(" "),e.modalId==="pick-gallery-"+e.realId?r("AssetsModal",{attrs:{assets:e.assets,pick:"multiple",picked:[].concat(e.galleryModel),"pick-limit":4},on:{confirm:e.confirmGallery}}):e._e()],1)])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{Icon:r(280).default,Btn:r(278).default,AssetsModal:r(297).default})},354:function(e,t,r){"use strict";r.r(t);r(14),r(32),r(33);var l=r(11),o=(r(25),r(4)),n={asyncData:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,n,c,article,d,m,f,h,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.$axios,o=e.route,n=[],c=[],t.prev=3,!o.params.id||"new"===o.params.id){t.next=9;break}return t.next=7,r.get("/api/articles/".concat(o.params.id));case 7:d=t.sent,article=d?d.data:null;case 9:return t.next=11,Promise.all([r.get("/api/assets"),r.get("/api/travels")]);case 11:m=t.sent,f=Object(l.a)(m,2),h=f[0],v=f[1],n=h.data,c=v.data,t.next=22;break;case 19:t.prev=19,t.t0=t.catch(3),console.log(t.t0);case 22:return console.log(article),t.abrupt("return",{assets:n,travels:c,article:article});case 24:case"end":return t.stop()}}),t,null,[[3,19]])})))()}},c=r(22),component=Object(c.a)(n,(function(){var e=this.$createElement;return(this._self._c||e)("ArticleForm",{attrs:{assets:this.assets,travels:this.travels,article:this.article}})}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{ArticleForm:r(340).default})}}]);