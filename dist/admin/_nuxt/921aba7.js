(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{295:function(e,t,r){var content=r(318);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(81).default)("f280b1c0",content,!0,{sourceMap:!1})},317:function(e,t,r){"use strict";var n=r(295);r.n(n).a},318:function(e,t,r){(t=r(80)(!1)).push([e.i,".loader{border:16px solid #f3f3f3;border-top-color:#3498db;border-radius:50%;width:120px;height:120px;-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite}",""]),e.exports=t},325:function(e,t,r){"use strict";r.r(t);var n={},l=(r(317),r(23)),component=Object(l.a)(n,(function(){var e=this.$createElement;this._self._c;return this._m(0)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"w-screen h-screen fixed bg-gray-200 inset-0 flex justify-center items-center z-50"},[t("div",{staticClass:"loader animation-spin"})])}],!1,null,null,null);t.default=component.exports},352:function(e,t,r){"use strict";r.r(t);r(19),r(31),r(17),r(53),r(46),r(47),r(32),r(18);var n=r(13);function l(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var o={props:{tabs:r(283).a.array.def([])},data:function(){return{mappedTabs:[]}},mounted:function(){this.mappedTabs=this.tabs.map((function(e,i){return c(c({},e),{},{active:0===i})}))},methods:{handleTabClick:function(e){this.$emit("tab",e),this.mappedTabs=this.mappedTabs.map((function(t){return c(c({},t),{},{active:t.key===e.key})}))}}},d=r(23),component=Object(d.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"flex m-6"},e._l(e.mappedTabs,(function(t){return r("div",{key:t.key,class:{"font-bold border-b-2 border-gray-400":t.active,"cursor-pointer mr-8 py-2":!0},on:{click:function(r){return e.handleTabClick(t)}}},[e._v("\n    "+e._s(t.name)+"\n  ")])})),0)}),[],!1,null,null,null);t.default=component.exports},353:function(e,t,r){"use strict";r.r(t);r(19),r(60),r(31),r(17),r(20),r(46),r(47),r(32),r(14),r(33),r(18),r(34),r(340),r(27);var n=r(4),l=r(13),c=r(283),o=r(344);function d(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var f={components:{FileUpload:r.n(o).a},props:{travels:c.a.array.def([])},data:function(){return{loading:!1,files:[],filesData:[]}},methods:{handleUpload:function(){this.$refs.upload.active=!0,this.loading=!0},inputFile:function(e,t){(!t||e&&t.name!==e.name)&&(console.log("PUSH NEW FILE DATA"),this.filesData.push(function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({id:e.id,name:e.name},{title_fr:"",title_it:"",place_fr:"",place_it:"",country_fr:"",country_it:"",desc_fr:"",desc_it:"",travel_id:""}))),e&&t&&!e.active&&t.active&&e.xhr},inputFilter:function(e,t,r){if(e&&!t&&!/\.(jpeg|jpe|jpg|gif|png|webp)$/i.test(e.name))return r();e.blob="";var n=window.URL||window.webkitURL;n&&n.createObjectURL&&(e.blob=n.createObjectURL(e.file))},uploadFiles:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new FormData,e.files.forEach((function(t,n){r.append("file[".concat(n,"]"),t.file),Object.keys(e.filesData[n]).forEach((function(t,i){r.append("infos[".concat(n,"][").concat(t,"]"),e.filesData[n][t])}))})),t.prev=2,t.next=5,e.$axios.post("/api/assets",r,{headers:{"Content-Type":"multipart/form-data"}});case 5:e.files=[],e.filesData=[],e.$toast.success(e.$t("assets.upload_success")),e.$emit("uploaded"),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(2),console.log("ERROR",t.t0),e.$toast.error(e.$t("assets.upload_error"));case 15:return t.prev=15,e.loading=!1,t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[2,11,15,18]])})))()}}},v=r(23),component=Object(v.a)(f,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"m-6"},[r("file-upload",{ref:"upload",attrs:{multiple:!0,"custom-action":e.uploadFiles},on:{"input-file":e.inputFile,"input-filter":e.inputFilter},model:{value:e.files,callback:function(t){e.files=t},expression:"files"}},[e.files.length?e._e():r("btn",{attrs:{type:"primary",label:e.$t("assets.upload")}})],1),e._v(" "),r("div",{staticClass:"flex flex-wrap"},e._l(e.files,(function(t,i){return r("div",{key:i,staticClass:"mr-4 my-4 w-56"},[r("input-text",{attrs:{small:"",placeholder:e.$t("assets.form.title")},model:{value:e.filesData[i]["title_"+e.$i18n.locale],callback:function(t){e.$set(e.filesData[i],"title_"+e.$i18n.locale,t)},expression:"filesData[i][`title_${$i18n.locale}`]"}}),e._v(" "),r("input-text",{attrs:{small:"",placeholder:e.$t("assets.form.place")},model:{value:e.filesData[i]["place_"+e.$i18n.locale],callback:function(t){e.$set(e.filesData[i],"place_"+e.$i18n.locale,t)},expression:"filesData[i][`place_${$i18n.locale}`]"}}),e._v(" "),r("Select",{attrs:{placeholder:e.$t("assets.form.travel"),options:e.travels,"option-label":"travel_title_"+e.$i18n.locale,"reduce-fn":function(e){return e.travel_id}},model:{value:e.filesData[i].travel_id,callback:function(t){e.$set(e.filesData[i],"travel_id",t)},expression:"filesData[i].travel_id"}}),e._v(" "),r("input-text",{attrs:{small:"",placeholder:e.$t("assets.form.country")},model:{value:e.filesData[i]["countries_"+e.$i18n.locale],callback:function(t){e.$set(e.filesData[i],"countries_"+e.$i18n.locale,t)},expression:"filesData[i][`countries_${$i18n.locale}`]"}}),e._v(" "),r("input-text",{attrs:{small:"",placeholder:e.$t("assets.form.description")},model:{value:e.filesData[i]["desc_"+e.$i18n.locale],callback:function(t){e.$set(e.filesData[i],"desc_"+e.$i18n.locale,t)},expression:"filesData[i][`desc_${$i18n.locale}`]"}}),e._v(" "),r("img",{staticClass:"w-56",attrs:{src:t.blob}}),e._v(" "),r("p",{staticClass:"text-sm"},[e._v("\n        "+e._s(t.name)+"\n      ")])],1)})),0),e._v(" "),r("btn",{directives:[{name:"show",rawName:"v-show",value:e.files.length&&(!e.$refs.upload||!e.$refs.upload.active),expression:"files.length && (!$refs.upload || !$refs.upload.active)"}],attrs:{type:"primary",label:e.$t("assets.do_upload")},on:{click:e.handleUpload}}),e._v(" "),e.loading?r("Loader"):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{Btn:r(284).default,InputText:r(288).default,Select:r(297).default,Loader:r(325).default})},354:function(e,t,r){"use strict";r.r(t);r(31),r(17),r(18);var n=r(283),l=r(332),c={components:{draggable:r.n(l).a},props:{assets:n.a.array.def([]),travels:n.a.array.def([]),articles:n.a.array.def([])},data:function(){return{locale:"fr",mounted:!1,assetsByTravel:{},filteredAssets:[],modifiedAssetsIds:{}}},mounted:function(){var e=this;this.locale=this.$i18n.locale,this.travels.forEach((function(t){e.$set(e.assetsByTravel,t.travel_id,e.assets.filter((function(e){return e.asset_travel_id===t.travel_id})))})),this.filteredAssets=this.assets.filter((function(e){return!e.asset_travel_id})),this.mounted=!0},methods:{handleAssetChange:function(e,t){if(e.added){var r=e.added.element;this.modifiedAssetsIds[r.asset_id]={past:r.asset_travel_id,present:t}}},getModifiedAssets:function(){return this.modifiedAssetsIds}}},o=r(23),component=Object(o.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.mounted?r("div",{staticClass:"flex"},[r("div",{staticClass:"assets-list w-1/3 p-4"},[r("h3",[e._v(e._s(e.$t("assets.non_associated")))]),e._v(" "),r("draggable",{class:{"flex flex-wrap py-8":!!e.filteredAssets.length},attrs:{list:e.filteredAssets,group:{name:"assets",pull:!0,put:!0}},on:{change:e.handleAssetChange}},e._l(e.filteredAssets,(function(e){return r("div",{key:"asset-"+e.asset_id,staticClass:"draggable-asset__container mr-2 mb-2"},[r("img",{staticClass:"w-24",attrs:{src:e.asset_src}})])})),0),e._v(" "),e.filteredAssets.length?e._e():r("div",{staticClass:"my-4 text-xs"},[e._v(e._s(e.$t("assets.non_associated_empty")))])],1),e._v(" "),r("div",{staticClass:"travels-list w-2/3 bg-gray-200 p-4 h-3/4 overflow-y-scroll"},e._l(e.travels,(function(t){return r("div",{key:"travel-"+t.travel_id},[r("h3",[e._v(e._s(t["travel_title_"+e.locale]))]),e._v(" "),r("draggable",{class:{"flex flex-wrap py-4":!!e.assetsByTravel[t.travel_id].length},attrs:{list:e.assetsByTravel[t.travel_id],group:{name:"assets",pull:!0,put:!0}},on:{change:function(r){return e.handleAssetChange(r,t.travel_id)}}},e._l(e.assetsByTravel[t.travel_id],(function(e){return r("div",{key:"asset-travel-"+e.asset_id},[r("img",{staticClass:"w-24 mr-2 mb-2",attrs:{src:e.asset_src}})])})),0),e._v(" "),e.assetsByTravel[t.travel_id].length?e._e():r("div",{staticClass:"my-4 text-xs"},[e._v(e._s(e.$t("assets.travel_empty")))])],1)})),0)]):e._e()}),[],!1,null,null,null);t.default=component.exports},355:function(e,t,r){"use strict";r.r(t);r(60),r(31),r(17),r(38),r(48),r(14),r(195),r(56),r(33),r(18),r(34);var n=r(134),l=r(283),c=r(332),o={components:{draggable:r.n(c).a},props:{assets:l.a.array.def([]),travels:l.a.array.def([]),articles:l.a.array.def([])},data:function(){return{locale:"fr",mounted:!1,assetsByArticle:{},modifiedAssetsIds:{}}},mounted:function(){var e=this;this.locale=this.$i18n.locale,this.articles.forEach((function(article){e.$set(e.assetsByArticle,article.article_id,e.assets.filter((function(e){return e.asset_article_ids.includes(article.article_id)})))})),this.mounted=!0},methods:{handleAssetChange:function(e,t){if(e.added){var r=e.added.element,l=!!this.modifiedAssetsIds[r.asset_id]?[].concat(Object(n.a)(r.asset_article_ids),Object(n.a)(this.modifiedAssetsIds[r.asset_id].present)):Object(n.a)(r.asset_article_ids);this.modifiedAssetsIds[r.asset_id]={past:r.asset_article_ids,present:Array.from(new Set([].concat(Object(n.a)(l),[t])))}}},removeAssetFromArticle:function(e,t){var r=!!this.modifiedAssetsIds[e.asset_id];this.modifiedAssetsIds[e.asset_id]={past:e.asset_article_ids,present:r?this.modifiedAssetsIds[e.asset_id].present.filter((function(a){return a!==e.asset_id})):e.asset_article_ids.filter((function(a){return a!==t}))},this.assetsByArticle[t]=this.assetsByArticle[t].filter((function(a){return a.asset_id!==e.asset_id}))},getModifiedAssets:function(){return this.modifiedAssetsIds}}},d=r(23),component=Object(d.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.mounted?r("div",{staticClass:"flex"},[r("div",{staticClass:"assets-list w-1/3 p-4 h-3/4 overflow-y-scroll"},[r("h3",[e._v(e._s(e.$t("assets.non_associated")))]),e._v(" "),r("draggable",{class:{"flex flex-wrap py-8":!!e.assets.length},attrs:{list:e.assets,group:{name:"assets",pull:"clone",put:!1}},on:{change:e.handleAssetChange}},e._l(e.assets,(function(e){return r("div",{key:"asset-"+e.asset_id,staticClass:"draggable-asset__container mr-2 mb-2"},[r("img",{staticClass:"w-24",attrs:{src:e.asset_src}})])})),0)],1),e._v(" "),r("div",{staticClass:"articles-list w-2/3 bg-gray-200 p-4 h-3/4 overflow-y-scroll"},e._l(e.articles,(function(article){return r("div",{key:"article-"+article.article_id},[r("h3",[e._v(e._s(article["article_title_"+e.locale]))]),e._v(" "),r("draggable",{class:{"flex flex-wrap py-4":!!e.assetsByArticle[article.article_id].length},attrs:{list:e.assetsByArticle[article.article_id],group:{name:"assets",pull:!1,put:!0}},on:{change:function(t){return e.handleAssetChange(t,article.article_id)}}},e._l(e.assetsByArticle[article.article_id],(function(t){return r("div",{key:"asset-article-"+t.asset_id,staticClass:"relative"},[r("span",{staticClass:"absolute top-0 right-0 my-2 mr-4 text-white",on:{click:function(r){return e.removeAssetFromArticle(t,article.article_id)}}},[r("Icon",{attrs:{name:"cross",small:""}})],1),e._v(" "),r("img",{staticClass:"w-24 mr-2 mb-2",attrs:{src:t.asset_src}})])})),0),e._v(" "),e.assetsByArticle[article.article_id].length?e._e():r("div",{staticClass:"my-4 text-xs"},[e._v("\n        "+e._s(e.$t("assets.article_empty"))+"\n      ")])],1)})),0)]):e._e()}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{Icon:r(286).default})},365:function(e,t,r){"use strict";r.r(t);r(19),r(31),r(82),r(17),r(190),r(46),r(47),r(32),r(14),r(33),r(18),r(34);var n=r(13),l=r(11),c=(r(27),r(4));function o(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?o(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):o(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var f={asyncData:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r,n,c,o,d,f,v,_,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$axios,n=[],c=[],o=[],t.prev=4,t.next=7,Promise.all([r.get("/api/assets"),r.get("/api/travels"),r.get("/api/articles")]);case 7:d=t.sent,f=Object(l.a)(d,3),v=f[0],_=f[1],m=f[2],n=v.data,c=_.data,o=m.data,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(4),console.log(t.t0);case 20:return t.abrupt("return",{assets:n,travels:c,articles:o});case 21:case"end":return t.stop()}}),t,null,[[4,17]])})))()},data:function(){return{activeTab:"library",tabs:[{key:"library",name:this.$t("assets.library")},{key:"travel-assets",name:this.$t("assets.travel_assets")},{key:"article-assets",name:this.$t("assets.article_assets")}]}},methods:{reloadAssets:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("/api/assets");case 2:r=t.sent,data=r.data,e.assets=data;case 5:case"end":return t.stop()}}),t)})))()},saveAssociatedAssets:function(){var e=this,t="travel-assets"===this.activeTabs?"travel":"article";try{var r={};"travel"===t&&(r=this.$refs.travelAssets.getModifiedAssets()),"article"===t&&(r=this.$refs.articleAssets.getModifiedAssets()),Object.keys(r).forEach(function(){var n=Object(c.a)(regeneratorRuntime.mark((function n(l){var c,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r[l].past===r[l].present){n.next=11;break}return n.prev=1,c=e.assets.find((function(a){return a.asset_id===Number(l)})),o=d(d({},c),{},{asset_article_ids:"travel"===t?JSON.stringify(c.asset_article_ids):JSON.stringify(r[l].present),asset_travel_id:"travel"===t?r[l].present:c.asset_travel_id}),n.next=6,e.$axios.put("/api/assets/".concat(l),o);case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),console.warn(n.t0);case 11:case"end":return n.stop()}}),n,null,[[1,8]])})));return function(e){return n.apply(this,arguments)}}()),this.$toast.success(this.$t("assets.updated_success"))}catch(e){this.$toast.success(this.$t("assets.updated_error"))}}}},v=r(23),component=Object(v.a)(f,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"flex justify-between"},[r("Tabs",{attrs:{tabs:e.tabs},on:{tab:function(t){e.activeTab=t.key}}}),e._v(" "),r("div",{staticClass:"self-center mr-4"},["library"!==e.activeTab?r("Btn",{attrs:{"icon-btn":"",icon:"floppy-disk"},on:{click:e.saveAssociatedAssets}}):e._e()],1)],1),e._v(" "),"library"===e.activeTab?r("div",[r("AssetPickerUploader",{attrs:{travels:e.travels},on:{uploaded:e.reloadAssets}}),e._v(" "),r("AssetPickerLibrary",{attrs:{assets:e.assets,data:{travels:e.travels,articles:e.articles}},on:{change:e.reloadAssets}})],1):"travel-assets"===e.activeTab?r("div",[r("DraggableTravelAssets",{ref:"travelAssets",attrs:{assets:e.assets,travels:e.travels,articles:e.articles}}),e._v(" "),r("div",{staticClass:"w-full flex justify-end"},[r("Btn",{staticClass:"m-4",attrs:{"icon-btn":"",icon:"floppy-disk"},on:{click:e.saveAssociatedAssets}})],1)],1):"article-assets"===e.activeTab?r("div",[r("DraggableArticleAssets",{ref:"articleAssets",attrs:{assets:e.assets,travels:e.travels,articles:e.articles}}),e._v(" "),r("div",{staticClass:"w-full flex justify-end"},[r("Btn",{staticClass:"m-4",attrs:{"icon-btn":"",icon:"floppy-disk"},on:{click:e.saveAssociatedAssets}})],1)],1):e._e()])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{Tabs:r(352).default,Btn:r(284).default,AssetPickerUploader:r(353).default,AssetPickerLibrary:r(309).default,DraggableTravelAssets:r(354).default,DraggableArticleAssets:r(355).default})}}]);